<h1 class="mb-4"><u>Task : <%= @task.title %></u></h1>

<div class="card shadow-sm w-50 align-items-center m-auto border border-primary" style="border-radius: 20px;">
  <div class="card-body">
    <p class="text-center"><u>Project: <%= @project.title %></u> </p>

    <p class="card-text">
      <strong>Description:</strong><br>
      <% if @task.description.present? %>
        <%= @task.description %>
      <% else %>
        <span class="text-muted">No description provided.</span>
      <% end %>
    </p>


    <p class="card-text">
      <strong>Manager:</strong>
      <% if @project.manager %>
        <%= @project.manager.name %>
      <% else %>
        <span class="text-muted">N/A</span>
      <% end %>
    </p>
    
    <p class="card-text">
      <strong>Assignee ID & Name:</strong>
      <% if @task.contributor_id %>
        <%= @task.contributor_id %> , <%= @task.user_as_contributor.name %>
      <% else %>
        <span class="text-muted">N/A</span>
      <% end %>
    </p>

    <p class="card-text">
      <strong>Status:</strong>
      <% if @task.status == 'not_started' %>
        <span class="badge bg-info text-dark"><%= @task.status.split('_').join(' ').upcase %></span>
      <% elsif @task.status == 'in_progress' %>
        <span class="badge bg-success text-dark"><%= @task.status.split('_').join(' ').upcase %></span>
      <% else %>
        <span class="badge bg-warning text-dark"><%= @task.status.split('_').join(' ').upcase %></span>
      <% end %>
    </p>

    <p class="card-text">
      <strong>Start Date:</strong>
      <%= @task.created_at.strftime('%d %B %Y') %>
    </p>

    <p class="card-text mt-3">
      <strong>Depends On:</strong><br>
        <% if @task.prerequisite_tasks.any? %>
         <ul class="list-group list-group-flush">
           <% @task.prerequisite_tasks.each do |prereq_task| %>
             <li class="list-group-item d-flex justify-content-between align-items-center">
               <%= link_to prereq_task.title, project_task_path(@project, prereq_task), class: "text-decoration-none" %>
               <span class="badge bg-secondary"><%= prereq_task.status.humanize %></span>
             </li>
           <% end %>
         </ul>
       <% else %>
         <span class="text-muted">No dependencies.</span>
       <% end %>
    </p>

    <p class="card-text mt-3">
      <strong>Dependent Tasks:</strong><br>
      <% if @task.dependent_tasks.any? %>
        <ul class="list-group list-group-flush">
          <% @task.dependent_tasks.each do |dep_task| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <%= link_to dep_task.title, project_task_path(@project, dep_task), class: "text-decoration-none" %>
              <span class="badge bg-secondary"><%= dep_task.status.humanize %></span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <span class="text-muted">No dependent tasks.</span>
      <% end %>
    </p>

    <div class="mt-4 d-flex flex-wrap gap-2">
      <%= link_to "Edit Task", edit_project_task_path(@project, @task), class: "btn btn-warning" %>

      <% unless current_user.contributor? %>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal"> Delete Task </button>
      <% end %>

      <% if current_user.admin? || current_user.manager? %>
        <%= link_to "Back to Project", project_tasks_path(@project), class: "btn btn-secondary" %>
      <% else %>
        <%= link_to "Back to Projects", projects_path, class: "btn btn-secondary" %>
      <% end %>
    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        Are you sure you want to delete task"<%= @task.title %>"?
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

        <%= button_to project_task_path(@project, @task),
              method: :delete,
              class: "btn btn-danger" do %>
          Yes, Delete
        <% end %>
      </div>

    </div>
  </div>
</div>
